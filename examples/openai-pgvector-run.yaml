# Example llama-stack configuration for OpenAI inference + PSQL (pgvector) vector index (RAG)
# 
# Notes:
# - You will need an OpenAI API key
# - You will need to setup PSQL with pgvector
# - The table schema must follow the expected schema in llama-stack (see rag_guide.md)
# 
version: 2
image_name: openai-pgvector-config

apis:
- agents
- inference
- vector_io
- tool_runtime
- safety

models:
- model_id: gpt-test
  provider_id: openai
  model_type: llm
  provider_model_id: gpt-4o-mini
- model_id: sentence-transformers/all-mpnet-base-v2
  metadata:
      embedding_dimension: 768
  model_type: embedding
  provider_id: sentence-transformers
  provider_model_id: /home/USER/lightspeed-stack/embedding_models/all-mpnet-base-v2
  
providers:
  inference:
  - provider_id: sentence-transformers
    provider_type: inline::sentence-transformers
    config: {}
  - provider_id: openai
    provider_type: remote::openai
    config:
      api_key: ${env.OPENAI_API_KEY}

  agents:
  - provider_id: meta-reference
    provider_type: inline::meta-reference
    config:
      persistence_store:
        type: sqlite
        db_path: .llama/distributions/ollama/agents_store.db
      responses_store:
        type: sqlite
        db_path: .llama/distributions/ollama/responses_store.db

  safety:
  - provider_id: llama-guard
    provider_type: inline::llama-guard
    config:
      excluded_categories: []

  vector_io:
  - provider_id: pgvector-example 
    provider_type: remote::pgvector
    config:
      host: localhost
      port: 5432
      db: pgvector_example # PostgreSQL database (psql -d pgvector_example)
      user: lightspeed # PostgreSQL user
      password: empty
      kvstore:
        type: sqlite
        db_path: .llama/distributions/pgvector/pgvector_registry.db

  tool_runtime:
  - provider_id: rag-runtime
    provider_type: inline::rag-runtime
    config: {}

tool_groups:
- provider_id: rag-runtime
  toolgroup_id: builtin::rag
  args: null
  mcp_endpoint: null

vector_dbs:
- embedding_dimension: 768
  embedding_model: sentence-transformers/all-mpnet-base-v2
  provider_id: pgvector-example 
  # A unique ID that becomes the PostgreSQL table name, prefixed with 'vector_store_'.
  # e.g., 'rhdocs' will create the table 'vector_store_rhdocs'.
  vector_db_id: rhdocs